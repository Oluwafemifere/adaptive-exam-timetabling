Based on the detailed frontend documentation and your existing backend API routes, here is a comprehensive list of the new API endpoints and WebSocket connections required to fully connect your frontend and backend.

### Summary of Analysis

Your current backend has a solid foundation for core data management (CRUD for exams, rooms, courses), user authentication, and basic scheduling job initiation. However, the frontend documentation describes a much richer, more interactive, and real-time experience that requires significant expansion of the API.

The key missing areas are:

- **Real-time Updates:** Many components on the Administrator dashboard expect live data (system status, job progress, notifications).
- **Complex Data Aggregation:** The Analytics and Dashboard pages require aggregated Key Performance Indicators (KPIs) and report data that go beyond simple entity retrieval.
- **Stateful & Interactive Operations:** Features like Scenario Management, Constraint Management, and the interactive Timetable Grid require dedicated endpoints for their complex operations.
- **User-Specific Portals:** The Student and Staff portals need endpoints to manage conflict reports and change requests.
- **Audit & History:** A comprehensive audit trail as described in the documentation needs dedicated endpoints.

---

### New REST API Endpoints to Build

Here is a detailed breakdown of the required new REST endpoints, organized by their corresponding feature area.

#### 1. Administrator Portal: Dashboard (`/pages/Dashboard.tsx`)

The dashboard needs aggregated data, not just raw entity lists.

- **Endpoint:** `GET /api/v1/system/dashboard-kpis`
  - **Purpose:** Fetch all the key performance indicators (KPIs) for the main dashboard. This avoids making dozens of separate API calls from the frontend.
  - **Existing:** You have a `GET /dashboard/{session_id}` route in `system.py`, which is a good start. It should be enhanced to return a more comprehensive payload.
  - **Required Response Body:**
    ```json
    {
      "totalExamsScheduled": 1250,
      "hardConstraintViolations": 15,
      "softConstraintViolations": 89,
      "roomUtilization": 78.5,
      "systemStatus": { "constraintEngine": "online", "syncStatus": "synced" },
      "recentActivity": [
        {
          "user": "admin@baze.edu",
          "action": "Updated exam CS101",
          "timestamp": "..."
        }
      ],
      "conflictHotspots": [
        { "date": "2025-10-20", "timeSlot": "14:00", "conflictCount": 8 }
      ],
      "resourceBottlenecks": [
        { "resourceType": "room", "name": "Hall A", "usage": 95.0 }
      ]
    }
    ```

#### 2. Administrator Portal: Constraints (`/pages/Constraints.tsx`)

This requires full CRUD operations for managing scheduling constraints.

- **Endpoint:** `GET /api/v1/constraints/`
  - **Purpose:** List all configured constraints (hard and soft).
- **Endpoint:** `POST /api/v1/constraints/`
  - **Purpose:** Create a new constraint.
  - **Request Body:** `{ "type": "soft", "name": "Instructor Preference", "weight": 80, "config": { ... } }`
- **Endpoint:** `PUT /api/v1/constraints/{constraint_id}`
  - **Purpose:** Update an existing constraint (e.g., change its weight).
- **Endpoint:** `DELETE /api/v1/constraints/{constraint_id}`
  - **Purpose:** Delete a constraint.

#### 3. Administrator Portal: Scenarios (`/pages/Scenarios.tsx`)

This feature allows for "what-if" analysis and requires state management on the backend.

- **Endpoint:** `POST /api/v1/scenarios/`
  - **Purpose:** Create a new "what-if" scenario, likely by cloning an existing timetable version and applying a different set of constraints.
  - **Request Body:** `{ "base_version_id": "uuid", "name": "Scenario with extra rooms", "constraint_overrides": [...] }`
- **Endpoint:** `GET /api/v1/scenarios/`
  - **Purpose:** List all created scenarios.
- **Endpoint:** `GET /api/v1/scenarios/{scenario_id}`
  - **Purpose:** Get the details and timetable result of a specific scenario.
- **Endpoint:** `POST /api/v1/scenarios/{scenario_id}/compare`
  - **Purpose:** Compare two scenarios and get a summary of the differences (e.g., change in conflict counts, resource usage).
  - **Request Body:** `{ "compare_with_scenario_id": "uuid" }`
- **Endpoint:** `DELETE /api/v1/scenarios/{scenario_id}`
  - **Purpose:** Delete a scenario.

#### 4. Administrator Portal: Notifications (`/pages/Notifications.tsx`)

This involves managing notifications generated by students and staff.

- **Endpoint:** `GET /api/v1/notifications/`
  - **Purpose:** Get a list of all system notifications for the administrator.
  - **Query Params:** `?status=pending` to filter by status.
- **Endpoint:** `POST /api/v1/notifications/mark-read`
  - **Purpose:** Mark a batch of notifications as read.
  - **Request Body:** `{ "notification_ids": ["uuid1", "uuid2"] }`

#### 5. Administrator Portal: History (`/pages/History.tsx`)

Your `system.py` has a manual audit log endpoint, but the frontend needs a way to _retrieve_ the history.

- **Endpoint:** `GET /api/v1/history/`
  - **Purpose:** Retrieve a paginated list of all audit trail events.
  - **Query Params:** `?entity_type=exam&entity_id=uuid` to filter for the history of a specific exam.
- **Endpoint:** `GET /api/v1/history/{log_id}`
  - **Purpose:** Get the detailed "before" and "after" data for a specific change event.

#### 6. Student Portal (`/pages/StudentPortal.tsx`)

This portal requires endpoints for students to manage their conflict reports.

- **Endpoint:** `GET /api/v1/student/schedule`
  - **Purpose:** Get the personal exam schedule for the currently authenticated student.
  - **Existing:** `schedules.py` has `/student/{student_id}` which is good, but a "me"-style endpoint is better for the logged-in user: `GET /api/v1/schedules/me/student`.
- **Endpoint:** `POST /api/v1/student/conflict-reports`
  - **Purpose:** Allow a student to submit a new conflict report.
  - **Request Body:** `{ "examId": "uuid", "description": "I have a medical appointment.", "conflictType": "personal" }`
- **Endpoint:** `GET /api/v1/student/conflict-reports`
  - **Purpose:** Get the status of all conflict reports submitted by the authenticated student.

#### 7. Staff Portal (`/pages/StaffPortal.tsx`)

This portal requires endpoints for staff to manage their assignments and change requests.

- **Endpoint:** `GET /api/v1/staff/assignments`
  - **Purpose:** Get all invigilation and instruction assignments for the currently authenticated staff member.
  - **Existing:** `schedules.py` has `/invigilator/{staff_id}`. A `GET /api/v1/schedules/me/staff` endpoint would be more appropriate.
- **Endpoint:** `POST /api/v1/staff/change-requests`
  - **Purpose:** Allow a staff member to submit a request to change an assignment.
  - **Request Body:** `{ "assignmentId": "uuid", "reason": "Time Conflict", "description": "Clashes with another academic commitment." }`
- **Endpoint:** `GET /api/v1/staff/change-requests`
  - **Purpose:** Get the status of all change requests submitted by the authenticated staff member.
- **Endpoint:** `PUT /api/v1/staff/availability`
  - **Purpose:** Allow staff to set their availability preferences for future scheduling runs.
  - **Request Body:** `{ "unavailable_slots": [{ "date": "...", "startTime": "...", "endTime": "..." }] }`

---

### WebSocket Connections to Build

WebSockets are crucial for the real-time features described in the documentation. They push data from the server to the client without the client needing to constantly ask for it.

#### 1. Scheduling Job Progress

- **Purpose:** To provide real-time updates on the progress of a running scheduling job, as shown on the `/pages/Scheduling.tsx` page.
- **Existing:** You have a `websockets.py` with a `/ws/jobs/{job_id}` endpoint. This is **perfect** and should be the foundation.
- **WebSocket Path:** `ws://your-api.com/api/v1/ws/jobs/{job_id}`
- **Server-to-Client Message Structure:** The frontend expects a detailed progress object.
  ```json
  {
    "isRunning": true,
    "phase": "cp-sat",
    "progress": 45.5,
    "jobId": "uuid-of-the-job",
    "metrics": {
      "hard_constraints_violations": 12,
      "soft_constraints_violations": 153,
      "processed_exams": 500,
      "total_exams": 1100
    }
  }
  ```

#### 2. System Status and Notifications

- **Purpose:** To power the real-time "System Status" KPIs on the dashboard and to push new notifications to administrators as they are created (e.g., when a student reports a conflict).
- **WebSocket Path:** `ws://your-api.com/api/v1/ws/system-events`
- **Authentication:** This connection should be authenticated and only available to administrators.
- **Server-to-Client Messages:** The server would send different event types over this single connection.
  - **System Status Update:**
    ```json
    {
      "eventType": "SYSTEM_STATUS_UPDATE",
      "payload": {
        "constraintEngine": "online",
        "syncStatus": "syncing",
        "activeJobs": 2
      }
    }
    ```
  - **New Notification:**
    ```json
    {
      "eventType": "NEW_NOTIFICATION",
      "payload": {
        "id": "uuid-notif",
        "type": "ConflictReport",
        "message": "Student John Doe reported a conflict for CS101.",
        "timestamp": "..."
      }
    }
    ```

#### 3. Live Timetable Collaboration (Advanced)

- **Purpose:** The documentation mentions real-time updates and collaboration. If multiple admins are viewing the timetable, changes made by one should appear instantly for others.
- **WebSocket Path:** `ws://your-api.com/api/v1/ws/timetable/{version_id}`
- **Authentication:** Restricted to administrators.
- **Client-to-Server Message:** When an admin drags and drops an exam.
  ```json
  {
    "action": "MOVE_EXAM",
    "payload": {
      "examId": "uuid-exam",
      "newDate": "2025-10-21",
      "newStartTime": "13:00"
    }
  }
  ```
- **Server-to-Client Message:** The server broadcasts the confirmed change to all connected clients.
  ```json
  {
    "eventType": "EXAM_UPDATED",
    "payload": {
      "examId": "uuid-exam",
      "user": "admin2@baze.edu",
      "changes": {
        "date": "2025-10-21",
        "startTime": "13:00",
        "endTime": "15:00"
      }
    }
  }
  ```
